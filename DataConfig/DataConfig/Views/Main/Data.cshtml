@using DataConfig.Helper
@using DataConfig.Models
@using DataConfig.Resources

@model Data

@section script {
    <script>
        var Config = {
            StorageName: @Html.Raw(Json.Encode(Model.ConfigStorageName)),
            StorageKey: @Html.Raw(Json.Encode(Model.ConfigStorageKey))
        };

        var Strings = {
            NoCatalogSelected: @Html.Raw(Json.Encode(Messages.NoCatalogSelected)),
            NoDatasetSelected: @Html.Raw(Json.Encode(Messages.NoDatasetSelected)),
            ConfirmDeleteCatalogs: @Html.Raw(Json.Encode(Messages.ConfirmDeleteCatalogs)),
            ConfirmDeleteDatasets: @Html.Raw(Json.Encode(Messages.ConfirmDeleteDatasets)),
            SelectAll: @Html.Raw(Json.Encode(UI.SelectAll)),
            DeselectAll: @Html.Raw(Json.Encode(UI.DeselectAll)),
            DeleteCatalog: @Html.Raw(Json.Encode(UI.DeleteCatalog)),
            DeleteDataset: @Html.Raw(Json.Encode(UI.DeleteDataset)),
            CatalogDeleted: @Html.Raw(Json.Encode(Messages.CatalogDeleted)),
            DatasetDeleted: @Html.Raw(Json.Encode(Messages.DatasetDeleted)),
            CatalogAdded: @Html.Raw(Json.Encode(Messages.CatalogAdded))
        };
    </script>
}

<form action="/Main/Data" method="post" id="datasetForm">
    <input type="hidden" name="ConfigStorageName" value="@Model.ConfigStorageName" />
    <input type="hidden" name="ConfigStorageKey" value="@Model.ConfigStorageKey" />
    <input type="hidden" name="Page" value="@Model.Page" />
    <input type="hidden" name="Order" value="@Model.Order" />
    <input type="hidden" name="CatalogFilter" value="@Model.CatalogFilter" />
    <input type="hidden" name="CategoryFilter" value="@Model.CategoryFilter" />
    <input type="hidden" name="KeywordFilter" value="@Model.KeywordFilter" />
</form>

<div class="row">
    <div class="twelve columns">
        <div id="alertBoxContainer">
        </div>
    </div>
</div>

<div class="row">
    <div class="twelve columns">
        <fieldset>
            <legend>@UI.Configuration</legend>
            <div class="panel radius">
                <div class="row">
                    <div class="ten columns">
                        <h5><i class="icon-general-checkmark"></i> @Model.ConfigStorageName</h5>
                    </div>
                    <div class="two columns">
                        <a href="/Main/Start" class="right tiny secondary button">@UI.Change</a>
                    </div>
                </div>
            </div>
        </fieldset>
    </div>
</div>

<div class="row">
    <div class="twelve columns">
        <dl class="tabs contained">
            <dt>@UI.DisplayBy</dt>
            <dd class="active"><a href="#displayByCatalog">@UI.Catalog</a></dd>
            <dd><a href="#displayByDataset">@UI.Dataset</a></dd>
            <div id="ajaxLoader" class="right">
                <img src="@Url.Content("~/Content/Images/AjaxLoader.gif")" alt="loading..." />
            </div>
        </dl>
        <ul class="tabs-content contained">
            <li class="active" id="displayByCatalogTab">
                @if (Model.Catalogs != null)
                {
                    <div class="row buttonBar">
                        <div class="twelve columns">
                            <a class="right small radius success button" data-reveal-id="addCatalogModal">@UI.NewCatalog</a>
                            <a class="right small radius secondary button" id="selectAllCatalogs">@UI.SelectAll</a>
                        </div>
                    </div>

                    <table id="catalogs">
                        <thead>
                            <tr>
                                <td class="deleteBox">
                                    <button class="tiny radius alert button" id="deleteCatalogs" title="@Messages.DeleteSelectedCatalogs">
                                        <i class="icon-general-remove"></i>
                                    </button>
                                </td>
                                <td class="hidden"></td>
                                <td class="hidden"></td>
                                <td>@UI.Alias</td>
                                <td>@UI.Description</td>
                                <td>@UI.Disclaimer</td>
                                <td>@UI.StorageAccount</td>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var catalog in Model.Catalogs)
                            {
                                <tr>
                                    <td class="deleteBox"><input type="checkbox" /></td>
                                    <td class="hidden partitionKey">@catalog.PartitionKey</td>
                                    <td class="hidden rowKey">@catalog.RowKey</td>
                                    <td title="@catalog.alias">@(catalog.alias != null && catalog.alias.Length > 20 ? catalog.alias.Substring(0, 18) + "..." : catalog.alias)</td>
                                    <td title="@catalog.description">@(catalog.description != null && catalog.description.Length > 32 ? catalog.description.Substring(0, 30) + "..." : catalog.description)</td>
                                    <td title="@catalog.disclaimer">@(catalog.disclaimer != null && catalog.disclaimer.Length > 32 ? catalog.disclaimer.Substring(0, 30) + "..." : catalog.disclaimer)</td>
                                    <td title="@catalog.storageaccountname">@(catalog.storageaccountname != null && catalog.storageaccountname.Length > 32 ? catalog.storageaccountname.Substring(0, 30) + "..." : catalog.storageaccountname)</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                }
                else
                {
                    <h5 class="centered">@UI.NoCatalog</h5>
                }
            </li>

            <li id="displayByDatasetTab">
                <div class="row">
                    @if (Model.Datasets != null)
                    {
                        <div class="nine columns">
                            <div class="row buttonBar">
                                <div class="twelve columns">
                                    <a class="right small radius success button" data-reveal-id="addDatasetModal">@UI.NewCatalog</a>
                                    <a class="right small radius secondary button" id="selectAllDatasets">@UI.SelectAll</a>
                                </div>
                            </div>

                            <div class="row">
                                <div class="twelve columns">
                                    <table id="datasets">
                                        <thead>
                                            <tr>
                                                <td class="deleteBox">
                                                    <button class="tiny radius alert button" id="deleteDatasets" title="@Messages.DeleteSelectedDatasets">
                                                        <i class="icon-general-remove"></i>
                                                    </button>
                                                </td>
                                                <td class="hidden"></td>
                                                <td class="hidden"></td>
                                                <td>@UI.EntitySet</td>
                                                <td>@UI.Name</td>
                                                <td>@UI.Source</td>
                                                <td>@UI.Category</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var dataset in Model.Datasets)
                                            {
                                                <tr>
                                                    <td class="deleteBox"><input type="checkbox" /></td>
                                                    <td class="hidden partitionKey">@dataset.PartitionKey</td>
                                                    <td class="hidden rowKey">@dataset.RowKey</td>
                                                    <td title="@dataset.entityset">@(dataset.entityset != null && dataset.entityset.Length > 30 ? dataset.entityset.Substring(0, 28) + "..." : dataset.entityset)</td>
                                                    <td title="@dataset.name">@(dataset.name != null && dataset.name.Length > 30 ? dataset.name.Substring(0, 28) + "..." : dataset.name)</td>
                                                    <td title="@dataset.source">@(dataset.source != null && dataset.source.Length > 30 ? dataset.source.Substring(0, 28) + "..." : dataset.source)</td>
                                                    <td title="@dataset.category">@(dataset.category != null && dataset.category.Length > 30 ? dataset.category.Substring(0, 28) + "..." : dataset.category)</td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="three columns">
                            <h5>Filtering</h5>
                        </div>
                    }
                    else
                    {
                        <h5 class="centered">@UI.NoDataset</h5>
                    }
                </div>
            </li>
        </ul>
    </div>
</div>

<div id="addCatalogModal" class="reveal-modal small">
    <h1>@UI.NewCatalog</h1>
    
    <label for="alias">@UI.Alias</label>
    <input type="text" id="alias" />

    <label for="description">@UI.Description</label>
    <input type="text" id="description" />

    <label for="disclaimer">@UI.Disclaimer</label>
    <input type="text" id="disclaimer" />

    <label for="dataStorageName">@UI.StorageName</label>
    <input type="text" id="dataStorageName" />

    <label for="dataStorageKey">@UI.StorageKey</label>
    <input type="text" id="dataStorageKey" />

    <button id="addCatalog" class="right radius success button">OK</button>

    <a class="close-reveal-modal">&#215;</a>
</div>
